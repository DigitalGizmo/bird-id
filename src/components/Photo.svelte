<script>
  import { onMount } from 'svelte';
  import LabelModal from "./LabelModal.svelte";
  export let assetPath;
  export let setView;
  export let content;

  let photoHeight = 2459;
  let photoWidth = 2048;
  // let modalLeft = 200;
  // let modalTop = 100;
  let modalPosition = {"x": 200, "y": 100};
  let svgHtmlRatio = 1;
  // let svgHtmlYRatio = 1;

  let isModalShowing = false;
  // let birdTitle = "tbd";
  let detailContent;

  onMount(() => {
    let exploded = document.getElementById('photo');
    let rect = exploded.getBoundingClientRect();
    // photoWidth =  Math.round(rect.width);
    photoHeight =  Math.round(rect.height);
    svgHtmlRatio = photoHeight/2048;
    console.log('default modalPosition x: ' + modalPosition.x);
  })


  function showLabel(_slug) { 
    detailContent = content.find((element) => element.slug === _slug);
    modalPosition.x = (detailContent.labelPos.x * svgHtmlRatio)-200;
    modalPosition.y = (detailContent.labelPos.y * svgHtmlRatio)-100;

    console.log('modalPosition x in show: ' + modalPosition.x);

    isModalShowing = true;
  };  
</script>

<main class="photo-menu">
  <div>
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
      viewBox="0 0 2048 2459">
    
      <g id="photo">
        <image width="2048" height="2459" 
        href="{assetPath}images/menu-pics/bird-case-1.jpg"/>
      </g>
    
      <g id="hotspots">
        <a href="/"
          on:click={(e) => { e.preventDefault(); showLabel('common-raven');}}>
          <path id="raven" class="hotspot" d="m545.69,822.84c11.4-16.69,44.19-13.42,53.11-13.42,6.69-5.58,36.3-9.91,48.14,5.89,19.47,20.23,30.77,54.33,35.9,59.77,3.95,4.18,9.53,15.25,18.49,18.1,31.53,10.01,71.01,76.87,78.49,96.55,3.19,8.4,27.42,54.74,21.85,53.63-5.58-1.12-34.24-46.18-29-34.87,5.68,12.25-.24,13.86,2.05,16.78s17.22,17.63,12.7,18.78c-2.16.55-7.89-1.61-5.65,7.31,2.23,8.92,29.66,39.97,19.32,53.13-4.69,5.97-10.04,4.26-16.83,1.9-2.07,7.97-13.29-.3-39.12-1.22-18.7-21.9-22.61-31.86-17.18-44.16,8.15-18.46-11.71-24.09-18.75-23.96-27.2.5.32,22.68-36.6,21.8-10.39-20.08,18.59-30.25,35.74-29.83l-5.61-10.93c-25.4.59-.63,17.59-39.91,17.8-5.77,30.34-21.46,16.56-23.23,13.8-3.56-5.55-.95-22.15,29.77-23.33.3-4.73,1.09-8.75-.15-16.01-3-17.56-41.88-45.19-53.01-62.56-17.13-26.71-13.03-48.87-10.91-68.62-1.12-10.04-6.8-29.03-12.99-39.25s-46.62-17.07-46.62-17.07Z"/>
        </a>
    
        <a href="/"
          on:click={(e) => { e.preventDefault(); showLabel('pileated-woodpecker');}}>
          <path id="pileated" class="hotspot" d="m1131.81,1168.58c-1.76,12.67,21.16,25.01,22.94,36.08,1.4,8.77-4.48,10.38-17.51,9.26-13.03-1.12-43.32-20.99-57.32-23.84s-81.82-6.16-143.4,36.81c-21.87,15.26,35.19,55.2,62.03,43.83,5.32,1.77,30.09,29.17,72.69,25.45,27.2-2.38,59.78,14.45,65.01-.61,16.92,1.68,4.47,34.96.39,51.18s22.03,59.46,32.53,57.78,40.46-43.44,34.62-57.42-12.13-20.96-8.33-36.02c4.09-16.16-1.31-20.83,5.32-21.12,7.5,7.83,11.58,24.86,51.84,9.95,12.41-4.6,28.92,10.92,70.35-17.61,33.26,2.24,109.75-16.87,67.22-58.96-32.16-31.82-97.48-31.83-124.32-30.16s-54.65,13.96-62.54,18.78c-17.37,10.62-28.85-10.4-29.54-20.17-.88-12.41,31.65-25.61,42.73-36.69-1.88-2.67-22.1-1.89-29.68,3.99,0,0-16.83-4.98-24.72-4.74-6.75.21-29.14,5.81-30.3,14.2Z"/>
        </a>
    
        <a href="/"
          on:click={(e) => { e.preventDefault(); showLabel('blackburnian-warbler');}}>
          <path id="warbler" class="hotspot" d="m563.23,2255.32c11.33-8.09,22.4,4.31,49.09,6.59,4.05.35,10.02,6.87,16,8.83.04.01.04.07,0,.07-2.04.23-18.32.33-23.75,9.28-3.93,6.47-11.74,17.75-17.06,20.41s-24.92,4.76-21.04-.72c5.04-7.12,11.13-12.07,11.13-12.07-15.95-.89-20.54-10.57-17.69-18.61,1.32-3.74-3.03-9.25,3.32-13.79Z"/>
        </a>
        
        <a href="/"
          on:click={(e) => { e.preventDefault(); showLabel('barn-owl');}}>
          <path class="hotspot" d="m924.38,716.07c-2.66-3.86-67.26,52.6-55.15,59.37,25.18,14.07,55.63,31.07,78.36,29.68-2.22,5.76,1.25,11.71,5.34,14.48,5.65-13.85,15.21-15.92,17.14,6.56,0,0,5.87-5.54,6.31-13.51.66-11.8-29.11-10.81-15.51-17.28,7.16-3.4,19.42-9.05,22.6-4.43,18.29,26.56,24.37,49.62,24.37,49.62,0,0,1.85,9.19,16.15-6.65,6-6.65-14.82-12.85-19.32-23.94-3.18-7.84-6.56-14.05-7.47-24.35-1.42-16.17,4.78-40.26,4.78-40.26,16.5-11.66,35.92-31.72,30.57-48.82,62.27,28.2,86.95-11.78,125.47-62.4,39.46-51.84,226.19-87.29,123.79-131.05-51.12-21.85-172.77,23.63-184.04,33.64-6.23,5.54-44.45,40.35-64.83,86.43-15.95-22.45-31.4-19.81-40.91-20.05-28.8,2.32-36.48,29.2-30.8,37.34,10.87,4.27,40.01-.36,46.44,14.13,6.43,14.49,3.08,17.61-3.98,24.1,1.48-8.48-7.09-20.08-19.79-13-2.36,1.32,5.32,4.52-5.61,14.47,10.63,3.84,9.51,8.92,11.81,13.59,7.38,3.84,7.72,11.38,5.71,13.22-2.16,1.97-4.63-6.39-10.43-6.72-1.63,4.08-8.27-2.95-6.89,8.46-3.77-.52-8.04-7.03-10.24-5.51-6.86,4.75-21.05-3.61-26.58-7.68-.37,7.97,4.43,17.43-7.68,15.95-2.36,8.27,19.27,17.06,7.38,15.36-6.2-.89-10.71-1.65-17.01-10.78Z"/>
        </a>
      </g>
    </svg>
  </div>


  {#if isModalShowing}
    <LabelModal 
      modalPosition = {modalPosition}
      detailContent = {detailContent}
      setView = {setView}
    />
  {/if}  

</main>